<div class="trafic-container">
  <h1 class="page-title">Tableau de Bord Trafic & Coordination</h1>

  <div class="stats-container" *ngIf="statistiques">
    <mat-card class="stat-card stat-depart">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>flight_takeoff</mat-icon>
        </div>
        <div class="stat-info">
          <span class="stat-value">{{ statistiques.departsAujourdhui }}</span>
          <span class="stat-label">Départs aujourd'hui</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card stat-arrivee">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>flight_land</mat-icon>
        </div>
        <div class="stat-info">
          <span class="stat-value">{{ statistiques.arrivesAujourdhui }}</span>
          <span class="stat-label">Arrivées aujourd'hui</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card stat-pistes">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>runway</mat-icon>
        </div>
        <div class="stat-info">
          <span class="stat-value">{{ statistiques.pistesOccupees }}/{{ statistiques.pistesTotales }}</span>
          <span class="stat-label">Pistes occupées</span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="section">
    <div class="section-header">
      <h2>Planification des Pistes</h2>
      <button mat-raised-button color="accent" (click)="ouvrirDialogueAffectation()">
        <mat-icon>add</mat-icon>
        Affecter piste
      </button>
    </div>

    <div class="table-container">
      <table mat-table [dataSource]="assignationsActives" class="assignations-table">
        <ng-container matColumnDef="vol">
          <th mat-header-cell *matHeaderCellDef>Vol</th>
          <td mat-cell *matCellDef="let assignation">{{ assignation.volNumero }}</td>
        </ng-container>

        <ng-container matColumnDef="piste">
          <th mat-header-cell *matHeaderCellDef>Piste</th>
          <td mat-cell *matCellDef="let assignation">{{ assignation.pisteId }}</td>
        </ng-container>

        <ng-container matColumnDef="debut">
          <th mat-header-cell *matHeaderCellDef>Début</th>
          <td mat-cell *matCellDef="let assignation">{{ formaterHoraire(assignation.heureDebut) }}</td>
        </ng-container>

        <ng-container matColumnDef="fin">
          <th mat-header-cell *matHeaderCellDef>Fin</th>
          <td mat-cell *matCellDef="let assignation">{{ formaterHoraire(assignation.heureFin) }}</td>
        </ng-container>

        <ng-container matColumnDef="type">
          <th mat-header-cell *matHeaderCellDef>Type</th>
          <td mat-cell *matCellDef="let assignation">
            <span class="type-badge" [ngClass]="'type-' + assignation.typeMouvement.toLowerCase()">
              {{ assignation.typeMouvement }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let assignation">
            <button mat-icon-button color="warn" (click)="confirmerLiberationPiste(assignation)" matTooltip="Libérer">
              <mat-icon>delete</mat-icon>
            </button>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="colonnesAssignations"></tr>
        <tr mat-row *matRowDef="let row; columns: colonnesAssignations;"></tr>
      </table>

      @if (assignationsActives.length === 0) {
        <div class="no-data">
          <p>Aucune assignation active</p>
        </div>
      }
    </div>
  </div>

  <div class="section">
    <h2>Vols au Départ</h2>
    <div class="table-container">
      <table mat-table [dataSource]="vols" class="vols-table">
        <ng-container matColumnDef="numero">
          <th mat-header-cell *matHeaderCellDef>Numéro</th>
          <td mat-cell *matCellDef="let vol">{{ vol.numero }}</td>
        </ng-container>

        <ng-container matColumnDef="destination">
          <th mat-header-cell *matHeaderCellDef>Destination</th>
          <td mat-cell *matCellDef="let vol">{{ vol.destination }}</td>
        </ng-container>

        <ng-container matColumnDef="horaire">
          <th mat-header-cell *matHeaderCellDef>Horaire</th>
          <td mat-cell *matCellDef="let vol">{{ formaterHoraire(vol.horaire) }}</td>
        </ng-container>

        <ng-container matColumnDef="statut">
          <th mat-header-cell *matHeaderCellDef>Statut</th>
          <td mat-cell *matCellDef="let vol">{{ vol.statut }}</td>
        </ng-container>

        <ng-container matColumnDef="piste">
          <th mat-header-cell *matHeaderCellDef>Piste</th>
          <td mat-cell *matCellDef="let vol">{{ vol.avionImmatriculation || '-' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="colonnesDeparts"></tr>
        <tr mat-row *matRowDef="let row; columns: colonnesDeparts;"></tr>
      </table>

      @if (vols.length === 0) {
        <div class="no-data">
          <p>Aucun vol au départ</p>
        </div>
      }
    </div>
  </div>

  <div class="section">
    <h2>Vols à l'Arrivée</h2>
    <div class="table-container">
      <table mat-table [dataSource]="arrivees" class="vols-table">
        <ng-container matColumnDef="numero">
          <th mat-header-cell *matHeaderCellDef>Numéro</th>
          <td mat-cell *matCellDef="let vol">{{ vol.numero }}</td>
        </ng-container>

        <ng-container matColumnDef="origine">
          <th mat-header-cell *matHeaderCellDef>Origine</th>
          <td mat-cell *matCellDef="let vol">{{ vol.origine }}</td>
        </ng-container>

        <ng-container matColumnDef="horaire">
          <th mat-header-cell *matHeaderCellDef>Horaire</th>
          <td mat-cell *matCellDef="let vol">{{ formaterHoraire(vol.horaire) }}</td>
        </ng-container>

        <ng-container matColumnDef="statut">
          <th mat-header-cell *matHeaderCellDef>Statut</th>
          <td mat-cell *matCellDef="let vol">{{ vol.statut }}</td>
        </ng-container>

        <ng-container matColumnDef="piste">
          <th mat-header-cell *matHeaderCellDef>Piste</th>
          <td mat-cell *matCellDef="let vol">{{ vol.avionImmatriculation || '-' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="colonnesArrivees"></tr>
        <tr mat-row *matRowDef="let row; columns: colonnesArrivees;"></tr>
      </table>

      @if (arrivees.length === 0) {
        <div class="no-data">
          <p>Aucun vol à l'arrivée</p>
        </div>
      }
    </div>
  </div>

  <div class="section interop-section">
    <div class="section-header">
      <h2>
        <mat-icon class="interop-icon">link</mat-icon>
        Coordination Externe
      </h2>
    </div>
    <div class="interop-content">
      <p class="interop-message"> Prêt à se connecter à l'API de l'aéroport de meFa</p>
      <mat-form-field appearance="outline">
        <mat-label>URL aeroport mefa (ou autre)</mat-label>
        <input matInput [(ngModel)]="urlAeroportExterne" placeholder="http://urlMEFA:8080">
      </mat-form-field>
      <button mat-raised-button color="primary" disabled>
        <mat-icon>download</mat-icon>
        Consulter vols partenaire
      </button>
      <p class="interop-note">En attente de connexion aeroport MeFa</p>
    </div>
  </div>
</div>
